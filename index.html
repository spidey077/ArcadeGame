<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="icon" type="image/png" href="logo.png">
<title>Laser Bounce Madness</title>

<style>
  body {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    overflow: hidden;
    background: #000;
    font-family: 'Segoe UI', Tahoma;
  }

  canvas {
    display: block;
    background: #111;
    border: 3px solid #0ff;
    box-shadow: 0 0 25px #0ff;
    border-radius: 10px;
  }

  /* MAIN MENU */
  #menu {
    position: absolute;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.9);
    color:#0ff;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    text-align:center;
    z-index:20;
  }

  #menu h1 {
    font-size: 64px;
    margin-bottom: 10px;
    text-shadow: 0 0 20px #0ff;
  }

  #menu p {
    font-size: 20px;
    margin-bottom: 30px;
    color:#0ff;
  }

  #menu button {
    padding: 12px 35px;
    font-size: 26px;
    margin-bottom: 5px;
    border:none;
    background:#0ff;
    color:#111;
    cursor:pointer;
    border-radius:8px;
    transition:0.2s;
  }
  #menu button:hover{
    background:#0aa;
  }

  /* SCORE */
  #score {
    position: absolute;
    top: 10px;
    left: 10px;
    color: #0ff;
    font-size: 24px;
    font-weight: bold;
    text-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
    z-index:5;
  }

  #highScore {
    position: absolute;
    top: 10px;
    right: 10px;
    color: #0ff;
    font-size: 24px;
    font-weight: bold;
    text-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
    z-index: 5;
  }

  /* GAME OVER */
  #gameOver {
    position: absolute;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.85);
    display:flex;
    justify-content: center;
    align-items: center;
    visibility:hidden;
    z-index: 10;
  }

  #gameOverContent {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    color:#0ff;
    text-shadow: 0 0 20px #0ff;
  }

  #gameOverText {
    font-size: 64px;
    font-weight: bold;
    margin-bottom: 20px;
  }

  #finalScore {
    font-size: 36px;
    margin-bottom: 30px;
  }

  #gameOver button {
    padding: 12px 35px;
    font-size: 26px;
    border:none;
    background:#0ff;
    color:#111;
    cursor:pointer;
    border-radius:8px;
    transition:0.2s;
  }

  #gameOver button:hover {
    background:#0aa;
  }

  #gameContainer {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }

</style>
</head>
<body>

<!-- MAIN MENU -->
<div id="menu">
  <h1>Laser Bounce Madness</h1>
  <p>Move with Arrow Keys â€¢ Shoot with Space</p>
  <button onclick="startGame('easy')">Easy</button>
  <button onclick="startGame('medium')">Medium</button>
  <button onclick="startGame('hard')">Hard</button>
  <button onclick="showInstructions()">Instructions</button>
  <div id="instructions" style="display:none; margin-top:20px; color:#0ff; font-size:18px; text-align:center;">
    Eat small green static drops to score 50 points.<br>
    Shoot moving dots while avoiding them to score 100 points.<br>
    Objective: Achieve the highest possible score.<br>
    Be aware: As your score increases, speed and number of moving dots also increase!
  </div>
</div>

<div id="score">Score: 0</div>
<div id="highScore">High Score: 0</div>

<!-- GAME OVER -->
<div id="gameOver">
  <div id="gameOverContent">
  <div id="gameOverText">GAME OVER</div>
  <div id="finalScore">Score: 0</div>
  
  <!-- Restart button -->
  <button onclick="restartGame()">Restart</button>
  <!-- Difficulty selection for game over -->
  <div>
    <p id="finalScore">Select Difficulty:</p>
    <button onclick="startGame('easy')">Easy</button>
    <button onclick="startGame('medium')">Medium</button>
    <button onclick="startGame('hard')">Hard</button>
  </div>
</div>

</div>

<div id="gameContainer">
  <canvas id="game"></canvas>
</div>

<!-- Sounds -->
<audio id="laserSound" src="laser.mp3" preload="auto"></audio>
<audio id="hitSound" src="hit.mp3" preload="auto"></audio>
<audio id="bounceSound" src="bounce.wav" preload="auto"></audio>
<audio id="bgMusic" src="bg.mp3" preload="auto"></audio>
<audio id="deathSound" src="death.mp3" preload="auto"></audio>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const laserSound = document.getElementById('laserSound');
const hitSound = document.getElementById('hitSound');
const bounceSound = document.getElementById('bounceSound');
const bgMusic = document.getElementById('bgMusic');
const deathSound = document.getElementById('deathSound');
let laserUnlockCount = 0; // track how many times ammo has been granted
let difficulty = "medium";
let gameRunning = false;
let highScore = parseInt(localStorage.getItem("laserBounceHighScore")) || 0;
document.getElementById("highScore").innerText = `High Score: ${highScore}`;

const DIFFICULTY_SETTINGS = {
  easy: { enemyCount: 6, speedMultiplier: 0.8, scoreStep: 400 },
  medium: { enemyCount: 8, speedMultiplier: 1, scoreStep: 400 },
  hard: { enemyCount: 10, speedMultiplier: 1.3, scoreStep: 250 }
};

document.addEventListener("click", () => { bgMusic.play(); }, { once: true });

function showInstructions() {
  const instr = document.getElementById('instructions');
  instr.style.display = instr.style.display === 'none' ? 'block' : 'none';
}

const menu = document.getElementById('menu');
const gameOverDiv = document.getElementById('gameOver');
const finalScoreSpan = document.getElementById('finalScore');

function resizeCanvas() {
  canvas.width = window.innerWidth * 0.95;
  canvas.height = window.innerHeight * 0.8;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

let WIDTH = canvas.width;
let HEIGHT = canvas.height;

// PLAYER
const player = { x: WIDTH/2, y: HEIGHT/2, radius: 18, speed: 6, dx: 0, dy: 0 };

// ENEMIES
let enemies = [];
let ENEMY_COUNT = 5;

function randomVel() { return Math.random() * 1.7 + 3; }

function spawnEnemy() {
  const speedBase = randomVel() * DIFFICULTY_SETTINGS[difficulty].speedMultiplier;
  const corner = Math.floor(Math.random() * 4);
  let x, y;
  const offset = 50;
  switch(corner) {
    case 0: x = Math.random()*offset+15; y = Math.random()*offset+15; break;
    case 1: x = WIDTH-Math.random()*offset-15; y = Math.random()*offset+15; break;
    case 2: x = Math.random()*offset+15; y = HEIGHT-Math.random()*offset-15; break;
    case 3: x = WIDTH-Math.random()*offset-15; y = HEIGHT-Math.random()*offset-15; break;
  }
  enemies.push({
    x, y,
    radius: 12,
    dx: (Math.random()<0.5?-1:1)*speedBase,
    dy: (Math.random()<0.5?-1:1)*speedBase,
    color: `hsl(${Math.random()*360},70%,50%)`,
    active: true
  });
}

for(let i=0;i<ENEMY_COUNT;i++) spawnEnemy();

// LASERS
let lasers = [];
const laserSpeed = 14;
let laserUnlocked = false;
let laserUnlockMessageTimer = 0;

// POWER ORBS
let powerOrbs = [];
function spawnOrb() {
  const orb = { x: Math.random()*(WIDTH-20)+10, y: Math.random()*(HEIGHT-20)+10, radius:8 };
  powerOrbs.push(orb);
  setTimeout(()=>{ const idx = powerOrbs.indexOf(orb); if(idx>=0) powerOrbs.splice(idx,1); },10000);
}

// INPUT
const keys = {};
document.addEventListener('keydown', e=> keys[e.key]=true);
document.addEventListener('keyup', e=> keys[e.key]=false);

document.addEventListener('keydown', e=>{
  if(e.key === " " && laserUnlocked && laserAmmo>0 && (player.dx!==0 || player.dy!==0)){
    lasers.push({ x:player.x, y:player.y, dx:player.dx*laserSpeed, dy:player.dy*laserSpeed, length:40 });
    laserSound.volume=0.5; laserSound.currentTime=0; laserSound.play();
    laserAmmo--;
  }
});

let score = 0;
let difficultyLevel = 0;
let frames = 0;
let gameOverTriggered = false;
let laserAmmo = 0;
const LASER_AMMO_PER_UNLOCK = 30;

// COLLISION
function collide(a,b){ return Math.hypot(a.x-b.x, a.y-b.y) < a.radius+b.radius; }
function startGame(selectedDifficulty){
  gameOverTriggered = false;
  difficulty = selectedDifficulty;
  ENEMY_COUNT = DIFFICULTY_SETTINGS[difficulty].enemyCount;
  enemies = []; 
  for(let i=0;i<ENEMY_COUNT;i++) spawnEnemy();
  
  menu.style.display = "none"; 
  gameOverDiv.style.visibility = "hidden";  
  gameRunning = true;
  
  laserUnlocked = false; 
  laserAmmo = 0; 
  laserUnlockMessageTimer = 0;
  laserUnlockCount = 0;  // <-- reset this
  score = 0; 
  frames = 0; 
  difficultyLevel = 0;
  
  bgMusic.volume = 0.4; 
  bgMusic.play();
  
  startOrbSpawner();
}

function restartGame(){
  gameOverTriggered = false;
  gameRunning = true;
  enemies = []; lasers = []; powerOrbs = []; 
  score = 0; frames = 0; difficultyLevel = 0;
  ENEMY_COUNT = DIFFICULTY_SETTINGS[difficulty].enemyCount; 
  for(let i=0;i<ENEMY_COUNT;i++) spawnEnemy();
  player.x = WIDTH/2; player.y = HEIGHT/2;
  gameOverDiv.style.visibility = "hidden";
  laserUnlocked = false; laserAmmo = 0; laserUnlockMessageTimer = 0;
  laserUnlockCount = 0;  // <-- reset this
  bgMusic.currentTime = 0; 
  bgMusic.play();
}

function gameOver(){
  if(gameOverTriggered) return;
  gameOverTriggered=true; gameRunning=false;
  deathSound.volume=1; deathSound.currentTime=0; deathSound.play();
  if(score>highScore){ highScore=score; localStorage.setItem("laserBounceHighScore",highScore); document.getElementById("highScore").innerText=`High Score: ${highScore}`; }
  finalScoreSpan.innerText=`Score: ${score}`;
  gameOverDiv.style.visibility="visible"; bgMusic.pause();
}

function startOrbSpawner(){
  setInterval(()=>{
    if(!gameRunning) return;
    const orb={ x:Math.random()*(WIDTH-20)+10, y:Math.random()*(HEIGHT-20)+10, radius:8 };
    powerOrbs.push(orb);
    setTimeout(()=>{ const idx=powerOrbs.indexOf(orb); if(idx>=0) powerOrbs.splice(idx,1); },10000);
  },3000);
}

// UPDATE
function update(){
  if(!gameRunning) return;
  frames++;
  player.dx=0; player.dy=0;
  if(keys["ArrowUp"]) player.dy=-player.speed;
  if(keys["ArrowDown"]) player.dy=player.speed;
  if(keys["ArrowLeft"]) player.dx=-player.speed;
  if(keys["ArrowRight"]) player.dx=player.speed;
  player.x=Math.max(player.radius, Math.min(WIDTH-player.radius, player.x+player.dx));
  player.y=Math.max(player.radius, Math.min(HEIGHT-player.radius, player.y+player.dy));

  // ENEMIES
  enemies.forEach(e=>{
    if(!e.active) return;
    e.x+=e.dx; e.y+=e.dy;
    if(e.x<e.radius || e.x>WIDTH-e.radius) e.dx*=-1;
    if(e.y<e.radius || e.y>HEIGHT-e.radius) e.dy*=-1;
    if(collide(e,player)) gameOver();
  });

  // LASERS
  for(let li=lasers.length-1;li>=0;li--){
    const l=lasers[li];
    l.x+=l.dx; l.y+=l.dy;
    if(l.x<0 || l.x>WIDTH || l.y<0 || l.y>HEIGHT){ lasers.splice(li,1); continue; }
    for(let ei=enemies.length-1; ei>=0; ei--){
      const e=enemies[ei];
      if(e.active && collide({x:l.x,y:l.y,radius:5},e)){
        e.active=false; hitSound.currentTime=0; hitSound.play();
        score+=100; lasers.splice(li,1); break;
      }
    }
  }

  // POWER ORBS
  for(let pi=powerOrbs.length-1;pi>=0;pi--){
    const p=powerOrbs[pi];
    if(collide(player,p)){ score+=50; powerOrbs.splice(pi,1); }
  }

  const step = DIFFICULTY_SETTINGS[difficulty].scoreStep;
  if(score >= (difficultyLevel+1)*step){
    difficultyLevel++;
    enemies.forEach(e=>{ e.dx*=1.1; e.dy*=1.1; });
    spawnEnemy();
  }
// First unlock at 200 points
// First unlock at 200 points
if(score >= 200 && !laserUnlocked) {
  laserUnlocked = true;             // enable shooting
  laserAmmo = LASER_AMMO_PER_UNLOCK; // give first ammo
  laserUnlockMessageTimer = 180;     // show "Laser Unlocked!" message
  laserSound.currentTime = 0;
  laserSound.play();                 // play sound only first time
  bgMusic.volume = 0.2;
  laserUnlockCount = 1;              // track ammo unlocks for future refills
}

// Ammo refill after every 200 points, no message, no sound
if(laserUnlocked) {
  const timesToGive = Math.floor((score - 200) / 200) + 1; // +1 because first unlock counted
  if(timesToGive > laserUnlockCount) {
    laserAmmo += LASER_AMMO_PER_UNLOCK; // refill laser silently
    bgMusic.volume = 0.2;
    laserUnlockCount = timesToGive;     // update count
  }
}



  if(laserUnlockMessageTimer>0) laserUnlockMessageTimer--;

  document.getElementById("score").innerText=`Score: ${score}`;
}

// DRAW
function draw(){
  ctx.fillStyle="#111"; ctx.fillRect(0,0,WIDTH,HEIGHT);

  // PLAYER
  ctx.fillStyle="yellow"; ctx.shadowColor="yellow"; ctx.shadowBlur=25;
  ctx.beginPath();
  ctx.moveTo(player.x,player.y-18); ctx.lineTo(player.x+18,player.y);
  ctx.lineTo(player.x,player.y+18); ctx.lineTo(player.x-18,player.y);
  ctx.closePath(); ctx.fill(); ctx.shadowBlur=0;

  if(laserUnlockMessageTimer>0){
    ctx.fillStyle="#0ff"; ctx.font="48px Segoe UI"; ctx.textAlign="center";
    ctx.shadowColor="#0ff"; ctx.shadowBlur=20; ctx.fillText("Laser Unlocked!",WIDTH/2,HEIGHT/2-100); ctx.shadowBlur=0;
  }

  // ENEMIES
  enemies.forEach(e=>{
    if(!e.active) return;
    ctx.fillStyle=e.color; ctx.shadowColor=e.color; ctx.shadowBlur=20;
    ctx.beginPath(); ctx.arc(e.x,e.y,e.radius,0,Math.PI*2); ctx.fill(); ctx.shadowBlur=0;
  });

  // LASERS
  lasers.forEach(l=>{
    const nx=l.dx/Math.hypot(l.dx,l.dy);
    const ny=l.dy/Math.hypot(l.dx,l.dy);
    const endX=l.x-nx*l.length; const endY=l.y-ny*l.length;

    ctx.strokeStyle="rgba(255,0,0,0.6)"; ctx.lineWidth=10; ctx.shadowColor="red"; ctx.shadowBlur=30;
    ctx.beginPath(); ctx.moveTo(l.x,l.y); ctx.lineTo(endX,endY); ctx.stroke();

    ctx.strokeStyle="#ff5555"; ctx.lineWidth=4; ctx.shadowBlur=0;
    ctx.beginPath(); ctx.moveTo(l.x,l.y); ctx.lineTo(endX,endY); ctx.stroke();
  });

  // POWER ORBS
  ctx.fillStyle="lime"; ctx.shadowColor="lime"; ctx.shadowBlur=25;
  powerOrbs.forEach(p=>{ ctx.beginPath(); ctx.arc(p.x,p.y,p.radius,0,Math.PI*2); ctx.fill(); });
  ctx.shadowBlur=0;
}

// LOOP
function loop(){ if(gameRunning){ update(); draw(); } requestAnimationFrame(loop); }
loop();
</script>

</body>
</html>


